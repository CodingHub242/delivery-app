<ion-header>
  <ion-toolbar>
    <ion-title>Worker Dashboard</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Loading dashboard...</p>
  </div>

  <!-- Dashboard Content -->
  <div class="dashboard-content" *ngIf="!isLoading">
    <!-- Worker Info Card -->
    <ion-card *ngIf="workerDetails">
      <ion-card-content>
        <ion-grid style="margin-top: 25px;">
          <ion-row>
            <ion-col size="8">
              <h2>{{ workerDetails.name }}</h2>
              <p>{{ workerDetails.vehicle_type }} - {{ workerDetails.phone_number }}</p>
            </ion-col>
            <ion-col size="4" class="text-right">
              <ion-badge [color]="workerStats.isAvailable ? 'success' : 'danger'">
                {{ workerStats.isAvailable ? 'Available' : 'Unavailable' }}
              </ion-badge>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-card-content>
    </ion-card>

    <!-- Availability Toggle -->
    <ion-card>
      <ion-card-content>
        <ion-item>
          <ion-label>Available for Orders</ion-label>
          <ion-toggle
            slot="end"
            [checked]="workerStats.isAvailable"
            (ionChange)="toggleAvailability()">
          </ion-toggle>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <!-- Quick Actions -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Quick Actions</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-button
          expand="block"
          color="primary"
          (click)="navigateToOrderAcceptance()">
          <ion-icon slot="start" name="navigate"></ion-icon>
          View Order Requests
        </ion-button>
      </ion-card-content>
    </ion-card>

    <!-- Statistics Cards -->
    <ion-grid>
      <ion-row>
        <ion-col size="6">
          <ion-card>
            <ion-card-content class="stat-card">
              <ion-icon name="stats-chart" color="primary"></ion-icon>
              <h3>{{ workerStats.totalOrders }}</h3>
              <p>Total Orders</p>
            </ion-card-content>
          </ion-card>
        </ion-col>
        <ion-col size="6">
          <ion-card>
            <ion-card-content class="stat-card">
              <ion-icon name="checkmark-circle" color="success"></ion-icon>
              <h3>{{ workerStats.completedOrders }}</h3>
              <p>Completed</p>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col size="6">
          <ion-card>
            <ion-card-content class="stat-card">
              <ion-icon name="wallet" color="warning"></ion-icon>
              <h3>{{ formatCurrency(workerStats.totalEarnings) }}</h3>
              <p>Earnings</p>
            </ion-card-content>
          </ion-card>
        </ion-col>
        <ion-col size="6">
          <ion-card>
            <ion-card-content class="stat-card">
              <ion-icon name="star" color="tertiary"></ion-icon>
              <h3>{{ workerStats.averageRating }}</h3>
              <p>Rating</p>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>

    <!-- Recent Orders -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Recent Orders</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list *ngIf="recentOrders.length > 0; else noOrders">
          <ion-item *ngFor="let order of recentOrders" button (click)="navigateToOrderAcceptance()">
            <ion-label>
              <h3>Order #{{ order.tracking_id }}</h3>
              <p>{{ order.user?.name }} - {{ formatCurrency(order.estimated_cost) }}</p>
              <p>{{ formatDate(order.created_at) }}</p>
            </ion-label>
            <ion-badge slot="end" [color]="getStatusColor(order.status)">
              {{ getStatusText(order.status) }}
            </ion-badge>
          </ion-item>
        </ion-list>
        <ng-template #noOrders>
          <p class="no-orders">No recent orders</p>
        </ng-template>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Refresher -->
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
</ion-content>
