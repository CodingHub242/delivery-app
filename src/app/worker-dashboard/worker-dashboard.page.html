<ion-header>
  <ion-toolbar>
    
  </ion-toolbar>
</ion-header>

<ion-content class="worker-dashboard">
  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Loading dashboard...</p>
  </div>

  <!-- Dashboard Content -->
  <div class="dashboard-content" *ngIf="!isLoading">
  <!-- Hero Section -->
  <div class="hero-section" *ngIf="workerDetails">
    <div class="hero-header">
      <div class="hero-info">
        <h1 class="text-white">Welcome, {{ workerDetails.name }}!</h1>
        <p>Manage your services and all assigned operations with ease</p>
      </div>
      <div class="hero-status">
        <ion-badge [color]="workerStats.isAvailable ? 'success' : 'danger'" class="status-badge">
          {{ workerStats.isAvailable ? 'Available' : 'Unavailable' }}
        </ion-badge>
        <div class="toggle-container">
          <ion-label>Available for Orders</ion-label>
          <ion-toggle
            [checked]="workerStats.isAvailable"
            (ionChange)="toggleAvailability()">
          </ion-toggle>
        </div>
      </div>
      <div class="quick-actions">
        <ion-button
          (click)="navigateToOrderAcceptance()">
          <ion-icon slot="start" name="navigate"></ion-icon>
          View Order Requests
        </ion-button>
      </div>
    </div>

    <!-- Statistics Cards inside Hero -->
    <div class="hero-stats">
      <ion-grid>
        <ion-row>
          <ion-col size="6">
            <div class="stat-card-glass">
              <ion-icon name="stats-chart" color="primary"></ion-icon>
              <h3>{{ workerStats.totalOrders }}</h3>
              <p>Total Orders</p>
            </div>
          </ion-col>
          <ion-col size="6">
            <div class="stat-card-glass">
              <ion-icon name="checkmark-circle" color="success"></ion-icon>
              <h3>{{ workerStats.completedOrders }}</h3>
              <p>Completed</p>
            </div>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="6">
            <div class="stat-card-glass">
              <ion-icon name="wallet" color="warning"></ion-icon>
              <h3>{{ formatCurrency(workerStats.totalEarnings) }}</h3>
              <p>Earnings</p>
            </div>
          </ion-col>
          <ion-col size="6">
            <div class="stat-card-glass">
              <ion-icon name="star" color="tertiary"></ion-icon>
              <h3>{{ workerStats.averageRating }}</h3>
              <p>Rating</p>
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>
  </div>
   
    <!-- Recent Orders -->
    <ion-card style="background: #fff;">
      <ion-card-header>
        <ion-card-title>Recent Orders</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list *ngIf="recentOrders.length > 0; else noOrders" style="background: #fff;--background: #fff;">
          <ion-item *ngFor="let order of recentOrders" button (click)="navigateToOrderAcceptance()" style="background: #fff;--background: #fff;">
            <ion-label>
              <h3>Order #{{ order.tracking_id }}</h3>
              <p>{{ order.user?.name }} - {{ formatCurrency(order.estimated_cost) }}</p>
              <p>{{ formatDate(order.created_at) }}</p>
            </ion-label>
            <ion-badge slot="end" [color]="getStatusColor(order.status)">
              {{ getStatusText(order.status) }}
            </ion-badge>
          </ion-item>
        </ion-list>
        <ng-template #noOrders>
          <p class="no-orders">No recent orders</p>
        </ng-template>
      </ion-card-content>
    </ion-card>

    <!-- Recent Services -->
    <ion-card style="background: #fff;">
      <ion-card-header>
        <ion-card-title>Recent Services</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list *ngIf="recentServices && recentServices.length > 0; else noServices" style="background: #fff;--background: #fff;">
          <ion-item *ngFor="let service of recentServices" button style="background: #fff;--background: #fff;">
            <ion-icon name="construct" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h3>{{ service.name }}</h3>
              <p>{{ service.description }}</p>
              <p>Base Price: {{ formatCurrency(service.base_price) }}</p>
            </ion-label>
            <ion-badge slot="end" color="success" *ngIf="service.is_active">Active</ion-badge>
            <ion-badge slot="end" color="medium" *ngIf="!service.is_active">Inactive</ion-badge>
          </ion-item>
        </ion-list>
        <ng-template #noServices>
          <p class="no-services">No recent services</p>
        </ng-template>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Refresher -->
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
</ion-content>
