<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="closeModal()" fill="clear">
        <ion-icon slot="icon-only" name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Change Password</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="changePassword()" [disabled]="loading || !isFormValid()" fill="clear">
        <ion-icon *ngIf="!loading" slot="icon-only" name="checkmark"></ion-icon>
        <ion-spinner *ngIf="loading" slot="icon-only"></ion-spinner>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="form-container">
    <!-- Error message -->
    <div *ngIf="error" class="error-message ion-margin-bottom">
      {{ error }}
    </div>

    <!-- Current Password field -->
    <ion-item>
      <ion-label position="stacked">Current Password *</ion-label>
      <ion-input 
        [type]="showCurrentPassword ? 'text' : 'password'" 
        [(ngModel)]="currentPassword" 
        placeholder="Enter your current password"
        required>
      </ion-input>
      <ion-button 
        slot="end" 
        fill="clear" 
        (click)="togglePasswordVisibility('current')">
        <ion-icon [name]="showCurrentPassword ? 'eyeOffOutline' : 'eyeOutline'"></ion-icon>
      </ion-button>
    </ion-item>

    <!-- New Password field -->
    <ion-item>
      <ion-label position="stacked">New Password *</ion-label>
      <ion-input 
        [type]="showNewPassword ? 'text' : 'password'" 
        [(ngModel)]="newPassword" 
        placeholder="Enter new password"
        required>
      </ion-input>
      <ion-button 
        slot="end" 
        fill="clear" 
        (click)="togglePasswordVisibility('new')">
        <ion-icon [name]="showNewPassword ? 'eyeOffOutline' : 'eyeOutline'"></ion-icon>
      </ion-button>
    </ion-item>

    <!-- Confirm Password field -->
    <ion-item>
      <ion-label position="stacked">Confirm New Password *</ion-label>
      <ion-input 
        [type]="showConfirmPassword ? 'text' : 'password'" 
        [(ngModel)]="confirmPassword" 
        placeholder="Confirm new password"
        required>
      </ion-input>
      <ion-button 
        slot="end" 
        fill="clear" 
        (click)="togglePasswordVisibility('confirm')">
        <ion-icon [name]="showConfirmPassword ? 'eyeOffOutline' : 'eyeOutline'"></ion-icon>
      </ion-button>
    </ion-item>

    <!-- Password requirements -->
    <div class="password-requirements">
      <p class="requirement-title">Password requirements:</p>
      <ul>
        <li [class.valid]="newPassword.length >= 6">At least 6 characters long</li>
        <li [class.valid]="newPassword === confirmPassword && confirmPassword.length > 0">Passwords match</li>
      </ul>
    </div>

    <!-- Change Password button -->
    <ion-button 
      expand="block" 
      (click)="changePassword()" 
      [disabled]="loading || !isFormValid() || newPassword !== confirmPassword || newPassword.length < 6"
      class="change-button">
      <ion-spinner *ngIf="loading" slot="start"></ion-spinner>
      {{ loading ? 'Changing...' : 'Change Password' }}
    </ion-button>
  </div>
</ion-content>
